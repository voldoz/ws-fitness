<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>WS Fitness</title>

<style>
  body{
    background:linear-gradient(135deg,#0f172a,#1e293b);
    color:#fff;
    font-family:Arial, sans-serif;
    padding:20px;
    margin:0;
  }
  h1{
    text-align:center;
    color:#38bdf8;
    margin:0 0 14px 0;
  }

  .tabs{
    display:flex;
    gap:10px;
    margin:12px 0 18px 0;
  }
  .tab-btn{
    flex:1;
    padding:12px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    font-weight:bold;
    color:#fff;
    background:#1e293b;
    transition:.2s;
  }
  .tab-btn.active{
    background:linear-gradient(90deg,#0ea5e9,#2563eb);
  }

  label{
    display:block;
    margin-top:14px;
    font-weight:bold;
  }

  select, input{
    width:100%;
    padding:12px;
    margin-top:6px;
    border:none;
    border-radius:12px;
    background:#1e293b;
    color:#fff;
    font-size:15px;
    outline:none;
  }

  /* Scroll احترافي (قد يختلف حسب المتصفح) */
  select::-webkit-scrollbar{ width:7px; }
  select::-webkit-scrollbar-track{ background:#0b1220; border-radius:10px; }
  select::-webkit-scrollbar-thumb{ background:#2563eb; border-radius:10px; }

  button.primary{
    margin-top:22px;
    width:100%;
    padding:16px;
    border:none;
    border-radius:14px;
    background:linear-gradient(90deg,#0ea5e9,#2563eb);
    color:#fff;
    font-size:18px;
    font-weight:bold;
    cursor:pointer;
    transition:.2s;
  }
  button.primary:active{ transform:scale(.99); }

  .results{
    margin-top:18px;
    background:#0f172a;
    padding:16px;
    border-radius:16px;
    display:none;
  }
  .box{
    background:#1e293b;
    padding:14px;
    border-radius:12px;
    margin-bottom:12px;
    line-height:1.7;
  }

  .page{ display:none; }
  .page.active{ display:block; }

  .small-note{
    opacity:.9;
    font-size:13px;
    margin-top:8px;
  }
  .danger{ color:#fecaca; }

  .grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    margin-top:10px;
  }
  @media (max-width:520px){
    .grid{ grid-template-columns:1fr; }
  }

  .mini-btn{
    margin-top:12px;
    width:100%;
    padding:12px;
    border:none;
    border-radius:12px;
    background:#1e293b;
    color:#fff;
    font-weight:bold;
    cursor:pointer;
  }
  .mini-btn:hover{ filter:brightness(1.08); }

  /* Page 3 Accordion */
  .day-card{
    background:#0f172a;
    border-radius:16px;
    padding:12px;
    margin-bottom:12px;
  }
  .day-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    cursor:pointer;
    padding:10px 10px;
    border-radius:12px;
    background:#0b1220;
  }
  .day-header:hover{ filter:brightness(1.07); }
  .day-name{
    color:#38bdf8;
    font-weight:bold;
  }
  .chev{
    opacity:.9;
    font-weight:bold;
  }
  .day-content{
    display:none;
    margin-top:10px;
  }
  .day-content.open{ display:block; }

  .exercise{
    background:#1e293b;
    border-radius:12px;
    padding:10px;
    margin-top:10px;
    display:grid;
    grid-template-columns: 1.3fr .6fr .8fr auto;
    gap:10px;
    align-items:center;
  }
  @media (max-width:520px){
    .exercise{ grid-template-columns: 1fr; }
  }

  .del-btn{
    border:none;
    background:#ef4444;
    color:#fff;
    padding:10px 12px;
    border-radius:12px;
    cursor:pointer;
    font-weight:bold;
  }
  .add-btn{
    border:none;
    background:linear-gradient(90deg,#0ea5e9,#2563eb);
    color:#fff;
    padding:10px 12px;
    border-radius:12px;
    cursor:pointer;
    font-weight:bold;
  }
  .row-actions{
    margin-top:10px;
    display:flex;
    gap:10px;
  }
  .row-actions button{ flex:1; }
</style>
</head>

<body>
<h1>WS Fitness</h1>

<div class="tabs">
  <button class="tab-btn active" id="tabCalc" onclick="showPage('calc')">الحاسبة</button>
  <button class="tab-btn" id="tabWeek" onclick="showPage('week')">متابعة الأسبوع</button>
  <button class="tab-btn" id="tabWork" onclick="showPage('work')">خطة التمارين</button>
</div>

<!-- PAGE 1: CALCULATOR -->
<div class="page active" id="pageCalc">
  <label>Weight</label>
  <select id="weight"></select>

  <label>Height</label>
  <select id="height"></select>

  <label>Age</label>
  <select id="age"></select>

  <label>Gender</label>
  <select id="gender">
    <option value="male">Male</option>
    <option value="female">Female</option>
  </select>

  <label>Activity Days</label>
  <select id="activityDays">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3" selected>3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
  </select>

  <label>Goal</label>
  <select id="goal">
    <option value="cut">Cut</option>
    <option value="maintain">Maintain</option>
    <option value="bulk">Bulk</option>
  </select>

  <label>Protein Multiplier</label>
  <select id="proteinFactor">
    <option value="1.5">1.5</option>
    <option value="1.8">1.8</option>
    <option value="2" selected>2</option>
    <option value="2.2">2.2</option>
    <option value="2.5">2.5</option>
    <option value="2.8">2.8</option>
    <option value="3">3</option>
  </select>

  <label>Meals</label>
  <select id="meals">
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6" selected>6</option>
  </select>

  <label>Weekly Goal</label>
  <select id="weeklyGoal">
    <option value="0.5">0.5 kg</option>
    <option value="1">1 kg</option>
    <option value="1.5">1.5 kg</option>
    <option value="2">2 kg</option>
  </select>

  <button class="primary" id="calcBtn">Calculate</button>

  <div class="results" id="resultsCalc">
    <div class="box" id="outCalories"></div>
    <div class="box" id="outMacros"></div>
    <div class="box" id="outPerMeal"></div>
    <div class="box" id="outBurn"></div>
    <div class="small-note">يتم حفظ هدف الحرق الأسبوعي تلقائياً لاستخدامه في متابعة الأسبوع.</div>
  </div>
</div>

<!-- PAGE 2: WEEK TRACKER -->
<div class="page" id="pageWeek">
  <div class="box">
    <div id="weeklyTargetLabel">Weekly target burn: -- kcal</div>
    <div class="small-note">ادخل كم سعرة حرقتها كل يوم. التطبيق يحسب الهدف المتبقي وهدف بكرة.</div>
  </div>

  <label>اليوم الحالي</label>
  <select id="todayIndex">
    <option value="1">Day 1</option>
    <option value="2">Day 2</option>
    <option value="3">Day 3</option>
    <option value="4">Day 4</option>
    <option value="5">Day 5</option>
    <option value="6">Day 6</option>
    <option value="7">Day 7</option>
  </select>

  <div class="grid" id="daysGrid"></div>

  <button class="mini-btn" onclick="recalcWeek()">تحديث الحساب</button>
  <button class="mini-btn" onclick="resetWeek()">مسح بيانات الأسبوع</button>

  <div class="results" id="resultsWeek" style="display:block;">
    <div class="box" id="wkBurned"></div>
    <div class="box" id="wkRemaining"></div>
    <div class="box" id="wkPerDay"></div>
    <div class="box" id="wkTomorrow"></div>
    <div class="small-note danger" id="wkWarn"></div>
  </div>
</div>

<!-- PAGE 3: WORKOUT PLAN -->
<div class="page" id="pageWork">
  <div class="box">
    <div style="font-weight:bold;color:#38bdf8;">Weekly Workout Plan</div>
    <div class="small-note">اضغط على اليوم لفتح التمارين. كل تمرين: الاسم + Sets + Max Weight. حفظ تلقائي.</div>
  </div>

  <div id="workoutContainer"></div>

  <button class="mini-btn" onclick="resetWorkouts()">مسح خطة التمارين كاملة</button>
</div>

<script>
/* ---------------- Tabs ---------------- */
function showPage(which){
  ["calc","week","work"].forEach(k=>{
    document.getElementById("page"+cap(k)).classList.remove("active");
    document.getElementById("tab"+cap(k)).classList.remove("active");
  });

  document.getElementById("page"+cap(which)).classList.add("active");
  document.getElementById("tab"+cap(which)).classList.add("active");

  if(which==="week"){ syncWeeklyTargetUI(); recalcWeek(); }
  if(which==="work"){ renderWorkouts(); }
}
function cap(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

/* ---------------- PAGE 1: Elements ---------------- */
const weightEl = document.getElementById("weight");
const heightEl = document.getElementById("height");
const ageEl = document.getElementById("age");
const genderEl = document.getElementById("gender");
const activityDaysEl = document.getElementById("activityDays");
const goalEl = document.getElementById("goal");
const proteinFactorEl = document.getElementById("proteinFactor");
const mealsEl = document.getElementById("meals");
const weeklyGoalEl = document.getElementById("weeklyGoal");

const resultsCalc = document.getElementById("resultsCalc");
const outCalories = document.getElementById("outCalories");
const outMacros = document.getElementById("outMacros");
const outPerMeal = document.getElementById("outPerMeal");
const outBurn = document.getElementById("outBurn");

/* Dropdowns */
for(let i=30;i<=200;i++){
  const opt=document.createElement("option");
  opt.value=i; opt.textContent=i+" kg";
  if(i===80) opt.selected=true;
  weightEl.appendChild(opt);
}
for(let i=130;i<=210;i++){
  const opt=document.createElement("option");
  opt.value=i; opt.textContent=i+" cm";
  if(i===170) opt.selected=true;
  heightEl.appendChild(opt);
}
for(let i=14;i<=80;i++){
  const opt=document.createElement("option");
  opt.value=i; opt.textContent=i+" years";
  if(i===30) opt.selected=true;
  ageEl.appendChild(opt);
}

/* Calculator */
function calculate(){
  const weight = parseFloat(weightEl.value);
  const height = parseFloat(heightEl.value);
  const age = parseFloat(ageEl.value);
  const gender = genderEl.value;
  const activityDays = parseInt(activityDaysEl.value,10);
  const goal = goalEl.value;
  const proteinFactor = parseFloat(proteinFactorEl.value);
  const meals = parseInt(mealsEl.value,10);
  const weeklyGoalKg = parseFloat(weeklyGoalEl.value);

  if(weeklyGoalKg === 2) alert("تنبيه: 2 kg/week هدف قوي جداً (عجز عالي).");

  const bmr = (gender === "male")
    ? (10*weight + 6.25*height - 5*age + 5)
    : (10*weight + 6.25*height - 5*age - 161);

  let activityMult = 1.2 + (activityDays - 1) * 0.1;
  if(activityMult > 1.9) activityMult = 1.9;

  let calories = bmr * activityMult;
  if(goal === "cut") calories -= 500;
  if(goal === "bulk") calories += 500;

  const protein = weight * proteinFactor;
  const fat = weight * 0.8;
  const carbs = (calories - (protein*4 + fat*9)) / 4;

  const proteinMeal = protein / meals;
  const carbsMeal = carbs / meals;
  const fatMeal = fat / meals;

  const chickenGrams = proteinMeal * 4;
  const riceGrams = carbsMeal * 3.5;
  const oilGrams = fatMeal;

  const weeklyTarget = weeklyGoalKg * 7700;
  const dailyBurn = weeklyTarget / 7;

  outCalories.textContent = `Daily Calories: ${Math.round(calories)} kcal`;
  outMacros.innerHTML = `Protein: ${Math.round(protein)} g<br>Carbs: ${Math.round(carbs)} g<br>Fat: ${Math.round(fat)} g`;
  outPerMeal.innerHTML =
    `Per Meal (${meals} meals):<br><br>`+
    `Protein: ${Math.round(proteinMeal)} g ≈ ${Math.round(chickenGrams)} g chicken<br>`+
    `Carbs: ${Math.round(carbsMeal)} g ≈ ${Math.round(riceGrams)} g rice<br>`+
    `Fat: ${Math.round(fatMeal)} g ≈ ${Math.round(oilGrams)} g oil`;
  outBurn.textContent = `Calories to burn daily to reach weekly goal: ${Math.round(dailyBurn)} kcal`;

  resultsCalc.style.display = "block";

  localStorage.setItem("ws_weekly_target", String(weeklyTarget));
  syncWeeklyTargetUI();
}
document.getElementById("calcBtn").addEventListener("click", calculate);

/* ---------------- PAGE 2: Weekly Tracker ---------------- */
const weeklyTargetLabel = document.getElementById("weeklyTargetLabel");
const daysGrid = document.getElementById("daysGrid");
const todayIndexEl = document.getElementById("todayIndex");

const wkBurned = document.getElementById("wkBurned");
const wkRemaining = document.getElementById("wkRemaining");
const wkPerDay = document.getElementById("wkPerDay");
const wkTomorrow = document.getElementById("wkTomorrow");
const wkWarn = document.getElementById("wkWarn");

function buildDays(){
  daysGrid.innerHTML = "";
  for(let d=1; d<=7; d++){
    const wrap = document.createElement("div");

    const lbl = document.createElement("label");
    lbl.textContent = `Day ${d} burned (kcal)`;
    lbl.style.marginTop = "0";

    const inp = document.createElement("input");
    inp.type = "number";
    inp.min = "0";
    inp.step = "10";
    inp.id = `day_${d}`;
    inp.placeholder = "0";

    const saved = localStorage.getItem(`ws_day_${d}`);
    if(saved !== null) inp.value = saved;

    inp.addEventListener("input", () => {
      localStorage.setItem(`ws_day_${d}`, inp.value || "");
      recalcWeek();
    });

    wrap.appendChild(lbl);
    wrap.appendChild(inp);
    daysGrid.appendChild(wrap);
  }
}
buildDays();

function getWeeklyTarget(){
  const v = localStorage.getItem("ws_weekly_target");
  if(!v) return 0;
  const n = parseFloat(v);
  return isFinite(n) ? n : 0;
}
function syncWeeklyTargetUI(){
  const target = getWeeklyTarget();
  weeklyTargetLabel.textContent = `Weekly target burn: ${Math.round(target)} kcal`;
}

function recalcWeek(){
  const target = getWeeklyTarget();
  if(target <= 0){
    wkWarn.textContent = "⚠️ احسب من صفحة الحاسبة أولاً عشان ينعرف هدف الأسبوع.";
    wkBurned.textContent = "Burned so far: --";
    wkRemaining.textContent = "Remaining: --";
    wkPerDay.textContent = "Required per remaining day: --";
    wkTomorrow.textContent = "Tomorrow target: --";
    return;
  } else wkWarn.textContent = "";

  let burned = 0;
  for(let d=1; d<=7; d++){
    const val = parseFloat((document.getElementById(`day_${d}`).value || "").trim());
    if(!isNaN(val) && val > 0) burned += val;
  }

  const remaining = Math.max(0, target - burned);
  const today = parseInt(todayIndexEl.value,10);
  const remainingDaysAfterToday = Math.max(0, 7 - today);
  const requiredPerDay = remainingDaysAfterToday > 0 ? (remaining / remainingDaysAfterToday) : remaining;

  wkBurned.textContent = `Burned so far: ${Math.round(burned)} kcal`;
  wkRemaining.textContent = `Remaining to reach weekly target: ${Math.round(remaining)} kcal`;

  if(remainingDaysAfterToday > 0){
    wkPerDay.textContent = `Required per day for remaining days (${remainingDaysAfterToday}): ${Math.round(requiredPerDay)} kcal/day`;
    wkTomorrow.textContent = `Tomorrow target burn: ${Math.round(requiredPerDay)} kcal`;
  } else {
    wkPerDay.textContent = `Week finished. Remaining: ${Math.round(remaining)} kcal`;
    wkTomorrow.textContent = `Tomorrow target: 0 kcal`;
  }
}

function resetWeek(){
  for(let d=1; d<=7; d++){
    localStorage.removeItem(`ws_day_${d}`);
    const el = document.getElementById(`day_${d}`);
    if(el) el.value = "";
  }
  recalcWeek();
}

/* ---------------- PAGE 3: Workout Plan (Sunday -> Saturday) ---------------- */
const workoutContainer = document.getElementById("workoutContainer");
const weekDays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

function defaultWorkouts(){
  const obj = {};
  weekDays.forEach(d => obj[d] = []);
  return obj;
}
function loadWorkouts(){
  const raw = localStorage.getItem("ws_workouts_v2");
  if(!raw) return defaultWorkouts();
  try{
    const parsed = JSON.parse(raw);
    weekDays.forEach(d => { if(!Array.isArray(parsed[d])) parsed[d] = []; });
    return parsed;
  }catch(e){
    return defaultWorkouts();
  }
}
function saveWorkouts(data){
  localStorage.setItem("ws_workouts_v2", JSON.stringify(data));
}

function addExercise(day){
  const data = loadWorkouts();
  data[day].push({ name:"", sets:3, maxWeight:"" });
  saveWorkouts(data);
  renderWorkouts();
}

function deleteExercise(day, idx){
  const data = loadWorkouts();
  data[day].splice(idx,1);
  saveWorkouts(data);
  renderWorkouts();
}

function updateExercise(day, idx, key, value){
  const data = loadWorkouts();
  if(!data[day] || !data[day][idx]) return;
  data[day][idx][key] = value;
  saveWorkouts(data);
}

function toggleDay(day){
  const safe = day.replace(/\s+/g,"_");
  const content = document.getElementById(`content_${safe}`);
  const chev = document.getElementById(`chev_${safe}`);
  const isOpen = content.classList.toggle("open");
  content.style.display = isOpen ? "block" : "none";
  chev.textContent = isOpen ? "▲" : "▼";
  localStorage.setItem(`ws_day_open_${safe}`, isOpen ? "1" : "0");
}

function renderWorkouts(){
  const data = loadWorkouts();
  workoutContainer.innerHTML = "";

  weekDays.forEach(day=>{
    const safe = day.replace(/\s+/g,"_");

    const card = document.createElement("div");
    card.className = "day-card";

    const header = document.createElement("div");
    header.className = "day-header";

    const left = document.createElement("div");
    left.className = "day-name";
    left.textContent = day;

    const chev = document.createElement("div");
    chev.className = "chev";
    chev.id = `chev_${safe}`;

    header.appendChild(left);
    header.appendChild(chev);
    header.onclick = () => toggleDay(day);

    card.appendChild(header);

    const content = document.createElement("div");
    content.className = "day-content";
    content.id = `content_${safe}`;

    const openState = localStorage.getItem(`ws_day_open_${safe}`);
    const open = openState === "1";
    content.style.display = open ? "block" : "none";
    chev.textContent = open ? "▲" : "▼";
    if(open) content.classList.add("open");

    const actions = document.createElement("div");
    actions.className = "row-actions";

    const addBtn = document.createElement("button");
    addBtn.className = "add-btn";
    addBtn.textContent = "+ Add Exercise";
    addBtn.onclick = (e)=>{ e.stopPropagation(); addExercise(day); };

    actions.appendChild(addBtn);
    content.appendChild(actions);

    if(data[day].length === 0){
      const empty = document.createElement("div");
      empty.className = "small-note";
      empty.textContent = "No exercises yet.";
      content.appendChild(empty);
    } else {
      data[day].forEach((ex, idx)=>{
        const row = document.createElement("div");
        row.className = "exercise";

        const name = document.createElement("input");
        name.placeholder = "Exercise";
        name.value = ex.name || "";
        name.oninput = (ev)=> updateExercise(day, idx, "name", ev.target.value);

        const sets = document.createElement("input");
        sets.type = "number";
        sets.min = "1";
        sets.max = "20";
        sets.placeholder = "Sets";
        sets.value = (ex.sets ?? 3);
        sets.oninput = (ev)=> updateExercise(day, idx, "sets", parseInt(ev.target.value || "0",10));

        const maxW = document.createElement("input");
        maxW.placeholder = "Max Weight (kg)";
        maxW.value = ex.maxWeight || "";
        maxW.oninput = (ev)=> updateExercise(day, idx, "maxWeight", ev.target.value);

        const del = document.createElement("button");
        del.className = "del-btn";
        del.textContent = "X";
        del.onclick = ()=> deleteExercise(day, idx);

        row.appendChild(name);
        row.appendChild(sets);
        row.appendChild(maxW);
        row.appendChild(del);

        content.appendChild(row);
      });
    }

    card.appendChild(content);
    workoutContainer.appendChild(card);
  });
}

function resetWorkouts(){
  if(confirm("أكيد تبي تمسح خطة التمارين كاملة؟")){
    localStorage.removeItem("ws_workouts_v2");
    weekDays.forEach(day=>{
      const safe = day.replace(/\s+/g,"_");
      localStorage.removeItem(`ws_day_open_${safe}`);
    });
    renderWorkouts();
  }
}

/* init */
syncWeeklyTargetUI();
recalcWeek();
renderWorkouts();
</script>
</body>
</html>
